name: Sync Release Version

on:
  release:
    types: [published]

jobs:
  update_version:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Extract version from release tag
        id: get_version
        run: |
          VERSION=${{ github.event.release.tag_name }}
          echo "VERSION=$VERSION" >> $GITHUB_ENV

      - name: Update version in pyproject.toml
        run: |
          sed -i "s/^version = .*/version = \"$VERSION\"/" pyproject.toml

      - name: Update __version__ in __init__.py
        run: |
          sed -i "s/^__version__ = .*/__version__ = \"$VERSION\"/" dstaf/__init__.py

      - name: Create new branch
        run: |
          BRANCH_NAME="sync-release-version-$VERSION"
          git checkout -b $BRANCH_NAME
          git add pyproject.toml dstaf/__init__.py
          git commit -m "Sync version to $VERSION"
          git push origin $BRANCH_NAME
          echo "BRANCH_NAME=$BRANCH_NAME" >> $GITHUB_ENV

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          branch: ${{ env.BRANCH_NAME }}
          title: "Sync version to ${{ env.VERSION }}"
          body: "Automated version synchronization from release."
          base: master
